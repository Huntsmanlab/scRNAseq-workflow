---
title: Comparing dim reduction plots before and after batch effect removal 
subtitle: '`r params$ids`'
author: "aslÄ±"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
    code_folding: hide

params:
  ids: 'DH3-DH4-DH10-DH15-DH16-DH17'
---

#### Batch effects can introduce unwanted variation to samples. It's important to normalize the batch effect before attempting to analyze samples together. Here we show some dimensionality reduction plots before and after batch normalization. 

```{r include = FALSE}

library(here)
source(here('..', 'sourceFiles', 'utilities.R'))

```

```{r include = FALSE}
# we start with the plots for uncorrected samples  
uncorrected <- readRDS(here('..', 'data', 'integrated', params$ids, 'uncorrected.rds'))

# some dim red plots 
p1 <- plotReducedDim(uncorrected, "TSNE", colour_by = "id") 
p2 <- plotReducedDim(uncorrected, "UMAP", colour_by = "id") 

```

```{r include = FALSE}
# now plots for batch corrected (integrated) samples 
integrated <- readRDS(here('..', 'data', 'integrated', params$ids, 'integrated.rds'))

# some dim red plots 
p3 <- DimPlot(integrated, reduction = 'tsne', group.by = 'id', combine = FALSE)
p4 <- DimPlot(integrated, reduction = 'umap', group.by = 'id', combine = FALSE)

p3 <- ggplotify::as.grob(p3[[1]])
p4 <- ggplotify::as.grob(p4[[1]])

```

Samples **before** batch correction  
Here we would expect samples to be separated by batch effects.  
```{r echo = FALSE, message = FALSE, fig.height = 5, fig.width = 10}

gridExtra::grid.arrange(p1, p2, nrow = 1)

```

Samples **after** batch correction  
Successful batch effect normalization should remove batch effect. Therefore we would expect to see samples dispersed more evenly. 
```{r echo = FALSE, message = FALSE, fig.height = 5, fig.width = 10}

gridExtra::grid.arrange(p3, p4, nrow = 1)

```









